#!/usr/bin/env zsh

DOTFILES_MINIMAL=false

WITH_ASDF=true
WITH_ZSH=true
WITH_VIM=true
WITH_TMUX=true
WITH_JAVA=true
WITH_CLJ=true
WITH_GO=true
WITH_GIT=true
WITH_VSCODE=true
while [ $# -gt 0 ]; do
    case "$1" in
        --no-asdf)
            WITH_ASDF=false
            ;;
        --no-zsh)
            WITH_ZSH=false
            ;;
        --no-vim)
            WITH_VIM=false
            ;;
        --no-tmux)
            WITH_TMUX=false
            ;;
        --no-clj)
            WITH_CLJ=false
            ;;
        --no-java)
            WITH_JAVA=false
            ;;
        --no-go)
            WITH_GO=false
            ;;
        --no-git)
            WITH_GIT=false
            ;;
        --no-vscode)
            WITH_VSCODE=false
            ;;
        --minimal)
            DOTFILES_MINIMAL=true
            ;;
    esac
    shift
done

DOTFILES_DIR="$(dirname ${0:A})"

cat <<END > "$HOME/.zsh_dotfiles_init"
# Warning: This file is auto-generated by ${0:A}.
# It will be overwritten as soon as ${0:A} is run again.
export DOTFILES_DIR=$DOTFILES_DIR
export DOTFILES_MINIMAL=$DOTFILES_MINIMAL

export ZSH=${ZSH:="$HOME/.oh-my-zsh"}
END

if [ -e "$HOME/.editorconfig" ]
then
    echo "$HOME/.editorconfig exists"
else
    ln -s "$DOTFILES_DIR/.editorconfig" "$HOME/.editorconfig"
fi

# Need to install ASDF first.
export WITH_GO
export WITH_CLJ
export WITH_JAVA
$WITH_ASDF && $DOTFILES_DIR/asdf/install.zsh

$WITH_GIT && $DOTFILES_DIR/git/install.zsh
$WITH_TMUX && $DOTFILES_DIR/tmux/install.zsh
$WITH_ZSH  && $DOTFILES_DIR/zsh/install.zsh
$WITH_VIM && $DOTFILES_DIR/vim/install.zsh
$WITH_VSCODE && $DOTFILES_DIR/vscode/install.zsh
